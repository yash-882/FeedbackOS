generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Organization {
  id                 String   @id @default(uuid())
  name               String   @db.VarChar(100)
  zendesk_subdomain  String?  @db.VarChar(255)
  slack_workspace_id String?  @db.VarChar(255)
  email              String?  @db.VarChar(255)
  created_at         DateTime @default(now())
  admin_id           String   @unique @db.VarChar(255)
  admin              User     @relation("OrganizationAdmin", fields: [admin_id], references: [id])
  users              User[]
}

model User {
  id                       String                 @id @default(uuid())
  name                     String                 @db.VarChar(100)
  email                    String                 @unique
  feedback_resources       FeedbackResourceType[] @default([])
  created_at               DateTime               @default(now())
  organization_id          String?                @db.VarChar(255)
  roles                    UserRole[]
  password                 String                 @db.VarChar(255)
  feedbacks                Feedback[]             @relation("FeedbackUser")
  feedback_summaries       FeedbackSummary[]      @relation("FeedbackSummaryUser")
  administeredOrganization Organization?          @relation("OrganizationAdmin")
  organization             Organization?          @relation(fields: [organization_id], references: [id])
}

model Feedback {
  id                  String               @id @default(uuid())
  user_id             String
  resource_type       FeedbackResourceType
  content             String
  priority            PriorityLevel
  is_negative         Boolean              @default(false)
  created_at          DateTime             @default(now())
  feedback_summary_id String
  feedback_summary    FeedbackSummary      @relation(fields: [feedback_summary_id], references: [id])
  user                User                 @relation("FeedbackUser", fields: [user_id], references: [id])
}

model FeedbackSummary {
  id         String     @id @default(uuid())
  user_id    String
  ai_summary String
  created_at DateTime   @default(now())
  feedbacks  Feedback[]
  user       User       @relation("FeedbackSummaryUser", fields: [user_id], references: [id])
}

enum UserRole {
  organization_admin
  team_member
  user
}

enum FeedbackResourceType {
  email
  zendesk
  slack
}

enum PriorityLevel {
  low
  medium
  high
  very_high
}
